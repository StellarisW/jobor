import{d as x,U as M,m as U,W as N,i as W,C as F,D as j,H as $,X as q,T as r,G as n,K as a,Y as D,Z as f,a4 as c,a5 as E,_ as B,$ as S,a0 as K,F as L,a6 as V,a1 as p,E as I,a7 as O,h as m}from "./index-18c4e01a.js";import{_ as G}from "./RoleSelect.vue_vue_type_script_setup_true_lang-4076a58b.js";import{N as H}from "./Switch-13ac4411.js";import{u as P,_ as X}from "./useTableData-51dd21fe.js";import{_ as Y,a as Z}from "./EditButton.vue_vue_type_script_setup_true_lang-09c400a5.js";import{_ as A}from "./TooltipText.vue_vue_type_script_setup_true_lang-253bca0d.js";import{_ as J,a as Q}from "./AutoOmissionTag.vue_vue_type_script_setup_true_lang-ad4c7ec6.js";import{b as ee}from "./Dropdown-a04ac224.js";import"./Forward-b27fe24b.js";import"./Icon-c53b6757.js";import"./Popconfirm-016139d9.js";import"./Space-fdc48c28.js";const ae={flex:"","justify-end":""},R=x({__name:"UserModal",props:{record:null},emits:["refresh"],setup(w, {emit:_}){const h=w,{record:l}=M(h),u=U(!1),v=U(null),{run:b,loading:g}=N(p.createUser),{run:y,loading:k}=N(p.editUser),e=U({username:"",nickname:"",email:"",phone:"",role_ids:[],user_type:"local",status:!0}),i={name:{required:!0,message:"请输入部门名",trigger:"blur"},code:{required:!0,message:"请输入code",trigger:"blur"}};function o(){var d,t;if(u.value=!0,l!=null&&l.value){const s=(t=(d=l.value)==null?void 0:d.roles)==null?void 0:t.map(z=>z.id);e.value={...l.value,role_ids:s}}}const C=W(()=>!!(l!=null&&l.value));function T(){var d;(d=v.value)==null||d.validate(async t=>{if(t)return;const{result:s}=l!=null&&l.value?await y(l==null?void 0:l.value.id,e.value):await b(e.value);s&&(u.value=!1,_("refresh"))})}return(d, t)=>(F(),j(L,null,[$("span",{onClick:o},[q(d.$slots,"default")]),r(a(K),{show:u.value,"onUpdate:show":t[8]||(t[8]= s=>u.value=s),title:"部门",preset:"card","auto-focus":!1,"w-200":""},{default:n(()=>[r(a(D),{ref_key:"formRef",ref:v,model:e.value,rules:i},{default:n(()=>[r(a(f),{path:"nickname",label:"显示名"},{default:n(()=>[r(a(c),{value:e.value.nickname,"onUpdate:value":t[0]||(t[0]= s=>e.value.nickname=s),placeholder:"输入显示名",onKeydown:t[1]||(t[1]=E(V(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),r(a(f),{path:"username",label:"用户名"},{default:n(()=>[r(a(c),{value:e.value.username,"onUpdate:value":t[2]||(t[2]= s=>e.value.username=s),disabled:a(C),placeholder:"请输入用户名"},null,8,["value","disabled"])]),_:1}),r(a(f),{path:"email",label:"邮箱"},{default:n(()=>[r(a(c),{value:e.value.email,"onUpdate:value":t[3]||(t[3]= s=>e.value.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),r(a(f),{path:"phone",label:"电话"},{default:n(()=>[r(a(c),{value:e.value.phone,"onUpdate:value":t[4]||(t[4]= s=>e.value.phone=s),placeholder:"请输入电话"},null,8,["value"])]),_:1}),r(a(f),{path:"role_ids",label:"用户角色"},{default:n(()=>[r(G,{value:e.value.role_ids,"onUpdate:value":t[5]||(t[5]= s=>e.value.role_ids=s),multiple:"",placeholder:"输入用户角色"},null,8,["value"])]),_:1}),r(a(f),{path:"status",label:"状态"},{default:n(()=>[r(a(H),{value:e.value.status,"onUpdate:value":t[6]||(t[6]= s=>e.value.status=s),placeholder:"请输入"},null,8,["value"])]),_:1}),$("div",ae,[r(a(B),{type:"primary",loading:a(g)||a(k),onClick:t[7]||(t[7]= s=>T())},{default:n(()=>[S(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ve=x({__name:"UserPage",setup(w){const{dataSource:_,loading:h,refresh:l,tableFilter:u,total:v,pagination:b}=P(p.getUserList);async function g(e){const{result:i}=await p.delUser(e);i&&l()}async function y(e, i){const{result:o}=await p.editUser(e,{status:i});o&&l()}const k=[{title:"序号",key:"id",width:"65"},{title:"用户",key:"nickname",width:"135",resizable:!0,render(e){return m(A,{label:""},{default:()=>e.nickname})}},{title:"用户名",key:"username",minWidth:"135",resizable:!0},{title:"邮箱",key:"email",resizable:!0},{title:"类型",key:"user_type",align:"center",width:"80",render(e){return m(ee,{bordered:!1,type:"primary"},{default:()=>e.user_type})}},{title:"角色",key:"roles",minWidth:"190",resizable:!0,ellipsis:{tooltip:{maxWidth:500}},render(e){var i;return m(J,{names:(i=e.roles)==null?void 0:i.map(o=>o.name)},{})}},{title:"状态",key:"status",width:90,fixed:"right",render(e){return m(Q,{status:e.status,checkFunction:()=>y(e.id,!e.status)})}},{title:"操作",key:"action",width:"170",fixed:"right",render(e){return[m(R,{record:e,onRefresh:l},{default:()=>m(Y)}),m(Z,{confirmText:"是否删除该用户",delFunction:()=>g(e.id)})]}}];return(e, i)=>(F(),I(X,{"table-filter":a(u),"onUpdate:tableFilter":i[0]||(i[0]= o=>O(u)?u.value=o:null),data:a(_),loading:a(h),columns:k,total:a(v),pagination:a(b),"search-key":"name","search-place-holder":"请输入用户名",onRefresh:a(l)},{header:n(()=>[r(R,{onRefresh:a(l)},{default:n(()=>[r(a(B),{type:"primary"},{default:n(()=>[S(" 新增用户 ")]),_:1})]),_:1},8,["onRefresh"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"]))}});export{ve as default};
