import{d as M,Z as q,m as R,$ as U,i as K,H as B,I as S,L as C,a0 as O,Y as l,K as i,P as e,a1 as T,a2 as s,a9 as m,aa as I,a3 as N,a4 as $,a5 as z,F as D,ab as P,ac as E,h as v,ap as V}from "./index-a4639770.js";import{s as b}from "./sysApi-004b66c0.js";import{N as F}from "./Switch-ccfe0e57.js";import{u as H,_ as j}from "./useTableData-1ff1bd86.js";import{_ as G,a as W}from "./EditButton.vue_vue_type_script_setup_true_lang-19ba1fe2.js";import{_ as Y}from "./TooltipText.vue_vue_type_script_setup_true_lang-5e80a96c.js";import"./Dropdown-c4cd24d0.js";import"./FocusDetector-f0e5f0c6.js";import"./Forward-11ddfa2e.js";import"./Popconfirm-faf230d4.js";const Z={flex:"","justify-end":""},L=M({__name:"ApiModal",props:{record:null},emits:["refresh"],setup(x, {emit:g}){const y=x,{record:a}=q(y),r=R(!1),h=R(null),{run:_,loading:w}=U(b.createApi),{run:c,loading:k}=U(b.editApi),n=R({name:"",title:"",dom:"",group:"",method:"",path:"",enabled:!1,enabled_audit:!1}),A={title:{required:!0,message:"请输入标题",trigger:"blur"},name:{required:!0,message:"请输入名称",trigger:"blur"}};function u(){r.value=!0,a!=null&&a.value&&(n.value={name:a.value.name,title:a.value.title,dom:a.value.dom,group:a.value.group,method:a.value.method,path:a.value.path,enabled:a.value.enabled,enabled_audit:a.value.enabled_audit})}const d=K(()=>!!(a!=null&&a.value));function f(){var p;(p=h.value)==null||p.validate(async t=>{if(t)return;const{result:o}=a!=null&&a.value?await c(a==null?void 0:a.value.id,n.value):await _(n.value);o&&(r.value=!1,g("refresh"))})}return(p, t)=>(B(),S(D,null,[C("span",{onClick:u},[O(p.$slots,"default")]),l(e(z),{show:r.value,"onUpdate:show":t[11]||(t[11]= o=>r.value=o),title:"API接口",preset:"card","auto-focus":!1,"w-200":""},{default:i(()=>[l(e(T),{ref_key:"formRef",ref:h,model:n.value,rules:A},{default:i(()=>[l(e(s),{path:"title",label:"中文名"},{default:i(()=>[l(e(m),{value:n.value.title,"onUpdate:value":t[0]||(t[0]= o=>n.value.title=o),placeholder:"输入中文名",onKeydown:t[1]||(t[1]=I(P(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(e(s),{path:"name",label:"API名"},{default:i(()=>[l(e(m),{value:n.value.name,"onUpdate:value":t[2]||(t[2]= o=>n.value.name=o),disabled:e(d),placeholder:"输入角色名",onKeydown:t[3]||(t[3]=I(P(()=>{},["prevent"]),["enter"]))},null,8,["value","disabled"])]),_:1}),l(e(s),{path:"dom",label:"域"},{default:i(()=>[l(e(m),{value:n.value.dom,"onUpdate:value":t[4]||(t[4]= o=>n.value.dom=o),placeholder:"所属域"},null,8,["value"])]),_:1}),l(e(s),{path:"group",label:"组"},{default:i(()=>[l(e(m),{value:n.value.group,"onUpdate:value":t[5]||(t[5]= o=>n.value.group=o),placeholder:"所属组"},null,8,["value"])]),_:1}),l(e(s),{path:"method",label:"方法"},{default:i(()=>[l(e(m),{value:n.value.method,"onUpdate:value":t[6]||(t[6]= o=>n.value.method=o),placeholder:"方法"},null,8,["value"])]),_:1}),l(e(s),{path:"path",label:"路径"},{default:i(()=>[l(e(m),{value:n.value.path,"onUpdate:value":t[7]||(t[7]= o=>n.value.path=o),placeholder:"方法"},null,8,["value"])]),_:1}),l(e(s),{path:"enabled",label:"启用接口"},{default:i(()=>[l(e(F),{value:n.value.enabled,"onUpdate:value":t[8]||(t[8]= o=>n.value.enabled=o),placeholder:"启用接口"},null,8,["value"])]),_:1}),l(e(s),{path:"enabled_audit",label:"启用审计"},{default:i(()=>[l(e(F),{value:n.value.enabled_audit,"onUpdate:value":t[9]||(t[9]= o=>n.value.enabled_audit=o),placeholder:"启用审计"},null,8,["value"])]),_:1}),C("div",Z,[l(e(N),{type:"primary",loading:e(w)||e(k),onClick:t[10]||(t[10]= o=>f())},{default:i(()=>[$(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ie=M({__name:"ApiPage",setup(x){const{dataSource:g,loading:y,refresh:a,tableFilter:r,total:h,pagination:_}=H(b.getApiList),{loading:w,run:c}=U(b.syncApi);async function k(){const{result:u}=await c();u&&a()}async function n(u){const{result:d}=await b.delApi(u);d&&a()}const A=[{title:"序号",key:"id",width:"65"},{title:"标题",key:"title",resizable:!0,render(u){return v(Y,{label:u.description},{default:()=>u.title})}},{title:"名称",key:"name",resizable:!0,ellipsis:{tooltip:!0}},{title:"分组",key:"group",width:"120"},{title:"请求方法",key:"method",width:"80",render: u=>{var p;const d=(p=u.method)==null?void 0:p.toUpperCase(),f=V[d];return v("div",{style:{color:f,fontWeight:"bolder"}},{default:()=>u.method})}},{title:"路径",key:"path",width:"16%",resizable:!0,ellipsis:{tooltip:!0}},{title:"更新时间",key:"updated_at",width:"185"},{title:"操作",key:"action",width:"170",fixed:"right",render(u){return[v(L,{record:u,onRefresh:a},{default:()=>v(G)}),v(W,{confirmText:"是否删除该API",delFunction:()=>n(u.id)})]}}];return(u, d)=>(B(),S("div",null,[l(j,{"table-filter":e(r),"onUpdate:tableFilter":d[1]||(d[1]= f=>E(r)?r.value=f:null),data:e(g),loading:e(y),columns:A,total:e(h),pagination:e(_),"search-key":"name","search-place-holder":"请输入API名",onRefresh:e(a)},{header:i(()=>[l(L,{onRefresh:e(a)},{default:i(()=>[l(e(N),{type:"primary"},{default:i(()=>[$(" 新增API ")]),_:1})]),_:1},8,["onRefresh"]),l(e(N),{quaternary:"",type:"primary",loading:e(w),style:{"margin-left":"5px"},onClick:d[0]||(d[0]= f=>k())},{default:i(()=>[$(" 同步 ")]),_:1},8,["loading"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"])]))}});export{ie as default};
