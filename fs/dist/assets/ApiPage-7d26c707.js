import{d as L,U as T,m as R,W as U,i as q,C as B,D as S,H as x,X as D,T as l,G as i,K as e,Y as K,Z as s,a4 as m,a5 as F,_ as N,$ as C,a0 as O,F as z,a6 as I,a7 as E,h as v,al as V}from "./index-18c4e01a.js";import{s as b}from "./sysApi-e58a5ada.js";import{N as M}from "./Switch-13ac4411.js";import{u as G,_ as H}from "./useTableData-51dd21fe.js";import{_ as W,a as j}from "./EditButton.vue_vue_type_script_setup_true_lang-09c400a5.js";import{_ as X}from "./TooltipText.vue_vue_type_script_setup_true_lang-253bca0d.js";import"./Dropdown-a04ac224.js";import"./Icon-c53b6757.js";import"./Forward-b27fe24b.js";import"./Popconfirm-016139d9.js";const Y={flex:"","justify-end":""},P=L({__name:"ApiModal",props:{record:null},emits:["refresh"],setup($, {emit:g}){const y=$,{record:a}=T(y),r=R(!1),h=R(null),{run:_,loading:w}=U(b.createApi),{run:c,loading:k}=U(b.editApi),n=R({name:"",title:"",dom:"",group:"",method:"",path:"",enabled:!1,enabled_audit:!1}),A={title:{required:!0,message:"请输入标题",trigger:"blur"},name:{required:!0,message:"请输入名称",trigger:"blur"}};function u(){r.value=!0,a!=null&&a.value&&(n.value={name:a.value.name,title:a.value.title,dom:a.value.dom,group:a.value.group,method:a.value.method,path:a.value.path,enabled:a.value.enabled,enabled_audit:a.value.enabled_audit})}const d=q(()=>!!(a!=null&&a.value));function f(){var p;(p=h.value)==null||p.validate(async t=>{if(t)return;const{result:o}=a!=null&&a.value?await c(a==null?void 0:a.value.id,n.value):await _(n.value);o&&(r.value=!1,g("refresh"))})}return(p, t)=>(B(),S(z,null,[x("span",{onClick:u},[D(p.$slots,"default")]),l(e(O),{show:r.value,"onUpdate:show":t[11]||(t[11]= o=>r.value=o),title:"API接口",preset:"card","auto-focus":!1,"w-200":""},{default:i(()=>[l(e(K),{ref_key:"formRef",ref:h,model:n.value,rules:A},{default:i(()=>[l(e(s),{path:"title",label:"中文名"},{default:i(()=>[l(e(m),{value:n.value.title,"onUpdate:value":t[0]||(t[0]= o=>n.value.title=o),placeholder:"输入中文名",onKeydown:t[1]||(t[1]=F(I(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(e(s),{path:"name",label:"API名"},{default:i(()=>[l(e(m),{value:n.value.name,"onUpdate:value":t[2]||(t[2]= o=>n.value.name=o),disabled:e(d),placeholder:"输入角色名",onKeydown:t[3]||(t[3]=F(I(()=>{},["prevent"]),["enter"]))},null,8,["value","disabled"])]),_:1}),l(e(s),{path:"dom",label:"域"},{default:i(()=>[l(e(m),{value:n.value.dom,"onUpdate:value":t[4]||(t[4]= o=>n.value.dom=o),placeholder:"所属域"},null,8,["value"])]),_:1}),l(e(s),{path:"group",label:"组"},{default:i(()=>[l(e(m),{value:n.value.group,"onUpdate:value":t[5]||(t[5]= o=>n.value.group=o),placeholder:"所属组"},null,8,["value"])]),_:1}),l(e(s),{path:"method",label:"方法"},{default:i(()=>[l(e(m),{value:n.value.method,"onUpdate:value":t[6]||(t[6]= o=>n.value.method=o),placeholder:"方法"},null,8,["value"])]),_:1}),l(e(s),{path:"path",label:"路径"},{default:i(()=>[l(e(m),{value:n.value.path,"onUpdate:value":t[7]||(t[7]= o=>n.value.path=o),placeholder:"方法"},null,8,["value"])]),_:1}),l(e(s),{path:"enabled",label:"启用接口"},{default:i(()=>[l(e(M),{value:n.value.enabled,"onUpdate:value":t[8]||(t[8]= o=>n.value.enabled=o),placeholder:"启用接口"},null,8,["value"])]),_:1}),l(e(s),{path:"enabled_audit",label:"启用审计"},{default:i(()=>[l(e(M),{value:n.value.enabled_audit,"onUpdate:value":t[9]||(t[9]= o=>n.value.enabled_audit=o),placeholder:"启用审计"},null,8,["value"])]),_:1}),x("div",Y,[l(e(N),{type:"primary",loading:e(w)||e(k),onClick:t[10]||(t[10]= o=>f())},{default:i(()=>[C(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ie=L({__name:"ApiPage",setup($){const{dataSource:g,loading:y,refresh:a,tableFilter:r,total:h,pagination:_}=G(b.getApiList),{loading:w,run:c}=U(b.syncApi);async function k(){const{result:u}=await c();u&&a()}async function n(u){const{result:d}=await b.delApi(u);d&&a()}const A=[{title:"序号",key:"id",width:"65"},{title:"标题",key:"title",resizable:!0,render(u){return v(X,{label:u.description},{default:()=>u.title})}},{title:"名称",key:"name",resizable:!0,ellipsis:{tooltip:!0}},{title:"分组",key:"group",width:"120"},{title:"请求方法",key:"method",width:"80",render: u=>{var p;const d=(p=u.method)==null?void 0:p.toUpperCase(),f=V[d];return v("div",{style:{color:f,fontWeight:"bolder"}},{default:()=>u.method})}},{title:"路径",key:"path",width:"16%",resizable:!0,ellipsis:{tooltip:!0}},{title:"更新时间",key:"updated_at",width:"185"},{title:"操作",key:"action",width:"170",fixed:"right",render(u){return[v(P,{record:u,onRefresh:a},{default:()=>v(W)}),v(j,{confirmText:"是否删除该API",delFunction:()=>n(u.id)})]}}];return(u, d)=>(B(),S("div",null,[l(H,{"table-filter":e(r),"onUpdate:tableFilter":d[1]||(d[1]= f=>E(r)?r.value=f:null),data:e(g),loading:e(y),columns:A,total:e(h),pagination:e(_),"search-key":"name","search-place-holder":"请输入API名",onRefresh:e(a)},{header:i(()=>[l(P,{onRefresh:e(a)},{default:i(()=>[l(e(N),{type:"primary"},{default:i(()=>[C(" 新增API ")]),_:1})]),_:1},8,["onRefresh"]),l(e(N),{quaternary:"",type:"primary",loading:e(w),style:{"margin-left":"5px"},onClick:d[0]||(d[0]= f=>k())},{default:i(()=>[C(" 同步 ")]),_:1},8,["loading"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"])]))}});export{ie as default};
