import{d as x,Z as M,m as U,$ as N,i as T,H as F,I as j,L as $,a0 as q,Y as r,K as n,P as a,a1 as I,a2 as f,a9 as c,aa as K,a3 as B,a4 as S,a5 as V,F as W,ab as D,a6 as p,J as E,ac as O,h as m}from "./index-a4639770.js";import{_ as P}from "./RoleSelect.vue_vue_type_script_setup_true_lang-0256ce2c.js";import{N as H}from "./Switch-ccfe0e57.js";import{u as J,_ as Y}from "./useTableData-1ff1bd86.js";import{_ as Z,a as A}from "./EditButton.vue_vue_type_script_setup_true_lang-19ba1fe2.js";import{_ as G}from "./TooltipText.vue_vue_type_script_setup_true_lang-5e80a96c.js";import{_ as Q,a as X}from "./AutoOmissionTag.vue_vue_type_script_setup_true_lang-a9cb4e31.js";import{e as ee}from "./Dropdown-c4cd24d0.js";import"./Forward-11ddfa2e.js";import"./FocusDetector-f0e5f0c6.js";import"./Popconfirm-faf230d4.js";import"./Space-1c3e7888.js";const ae={flex:"","justify-end":""},R=x({__name:"UserModal",props:{record:null},emits:["refresh"],setup(w, {emit:_}){const h=w,{record:l}=M(h),u=U(!1),v=U(null),{run:b,loading:g}=N(p.createUser),{run:y,loading:k}=N(p.editUser),e=U({username:"",nickname:"",email:"",phone:"",role_ids:[],user_type:"local",status:!0}),i={name:{required:!0,message:"请输入部门名",trigger:"blur"},code:{required:!0,message:"请输入code",trigger:"blur"}};function o(){var d,t;if(u.value=!0,l!=null&&l.value){const s=(t=(d=l.value)==null?void 0:d.roles)==null?void 0:t.map(L=>L.id);e.value={...l.value,role_ids:s}}}const z=T(()=>!!(l!=null&&l.value));function C(){var d;(d=v.value)==null||d.validate(async t=>{if(t)return;const{result:s}=l!=null&&l.value?await y(l==null?void 0:l.value.id,e.value):await b(e.value);s&&(u.value=!1,_("refresh"))})}return(d, t)=>(F(),j(W,null,[$("span",{onClick:o},[q(d.$slots,"default")]),r(a(V),{show:u.value,"onUpdate:show":t[8]||(t[8]= s=>u.value=s),title:"部门",preset:"card","auto-focus":!1,"w-200":""},{default:n(()=>[r(a(I),{ref_key:"formRef",ref:v,model:e.value,rules:i},{default:n(()=>[r(a(f),{path:"nickname",label:"显示名"},{default:n(()=>[r(a(c),{value:e.value.nickname,"onUpdate:value":t[0]||(t[0]= s=>e.value.nickname=s),placeholder:"输入显示名",onKeydown:t[1]||(t[1]=K(D(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),r(a(f),{path:"username",label:"用户名"},{default:n(()=>[r(a(c),{value:e.value.username,"onUpdate:value":t[2]||(t[2]= s=>e.value.username=s),disabled:a(z),placeholder:"请输入用户名"},null,8,["value","disabled"])]),_:1}),r(a(f),{path:"email",label:"邮箱"},{default:n(()=>[r(a(c),{value:e.value.email,"onUpdate:value":t[3]||(t[3]= s=>e.value.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),r(a(f),{path:"phone",label:"电话"},{default:n(()=>[r(a(c),{value:e.value.phone,"onUpdate:value":t[4]||(t[4]= s=>e.value.phone=s),placeholder:"请输入电话"},null,8,["value"])]),_:1}),r(a(f),{path:"role_ids",label:"用户角色"},{default:n(()=>[r(P,{value:e.value.role_ids,"onUpdate:value":t[5]||(t[5]= s=>e.value.role_ids=s),multiple:"",placeholder:"输入用户角色"},null,8,["value"])]),_:1}),r(a(f),{path:"status",label:"状态"},{default:n(()=>[r(a(H),{value:e.value.status,"onUpdate:value":t[6]||(t[6]= s=>e.value.status=s),placeholder:"请输入"},null,8,["value"])]),_:1}),$("div",ae,[r(a(B),{type:"primary",loading:a(g)||a(k),onClick:t[7]||(t[7]= s=>C())},{default:n(()=>[S(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ve=x({__name:"UserPage",setup(w){const{dataSource:_,loading:h,refresh:l,tableFilter:u,total:v,pagination:b}=J(p.getUserList);async function g(e){const{result:i}=await p.delUser(e);i&&l()}async function y(e, i){const{result:o}=await p.editUser(e,{status:i});o&&l()}const k=[{title:"序号",key:"id",width:"65"},{title:"用户",key:"nickname",width:"135",resizable:!0,render(e){return m(G,{label:""},{default:()=>e.nickname})}},{title:"用户名",key:"username",minWidth:"135",resizable:!0},{title:"邮箱",key:"email",resizable:!0},{title:"类型",key:"user_type",align:"center",width:"80",render(e){return m(ee,{bordered:!1,type:"primary"},{default:()=>e.user_type})}},{title:"角色",key:"roles",minWidth:"190",resizable:!0,ellipsis:{tooltip:{maxWidth:500}},render(e){var i;return m(Q,{names:(i=e.roles)==null?void 0:i.map(o=>o.name)},{})}},{title:"状态",key:"status",width:90,fixed:"right",render(e){return m(X,{status:e.status,checkFunction:()=>y(e.id,!e.status)})}},{title:"操作",key:"action",width:"170",fixed:"right",render(e){return[m(R,{record:e,onRefresh:l},{default:()=>m(Z)}),m(A,{confirmText:"是否删除该用户",delFunction:()=>g(e.id)})]}}];return(e, i)=>(F(),E(Y,{"table-filter":a(u),"onUpdate:tableFilter":i[0]||(i[0]= o=>O(u)?u.value=o:null),data:a(_),loading:a(h),columns:k,total:a(v),pagination:a(b),"search-key":"name","search-place-holder":"请输入用户名",onRefresh:a(l)},{header:n(()=>[r(R,{onRefresh:a(l)},{default:n(()=>[r(a(B),{type:"primary"},{default:n(()=>[S(" 新增用户 ")]),_:1})]),_:1},8,["onRefresh"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"]))}});export{ve as default};
