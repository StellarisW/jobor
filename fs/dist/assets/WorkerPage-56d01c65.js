import{d as y,H as n,I as O,L as z,a_ as H,J as i,an as _,P as t,K as l,Y as o,b7 as L,F as P,M as A,b2 as w,a4 as h,_ as T,Z as j,m as q,$ as V,S as Z,i as R,a0 as Q,a1 as X,a2 as m,a9 as k,aa as ee,a3 as F,a5 as te,ab as ae,ac as le,h as b}from "./index-a4639770.js";import{w as W}from "./worker-23c6cd36.js";import{i as I,b as re,e as C}from "./Dropdown-c4cd24d0.js";import{N as D}from "./Space-1c3e7888.js";import{b as E,d as G,u as ue,_ as oe}from "./useTableData-1ff1bd86.js";import{N as M}from "./InputNumber-4bde0193.js";import{_ as se,a as ne}from "./EditButton.vue_vue_type_script_setup_true_lang-19ba1fe2.js";import{_ as ie}from "./TooltipText.vue_vue_type_script_setup_true_lang-5e80a96c.js";import{_ as B}from "./Bage.vue_vue_type_script_setup_true_lang-f11b176d.js";import{N as de}from "./Popconfirm-faf230d4.js";import{_ as pe}from "./_plugin-vue_export-helper-c27b6911.js";import"./FocusDetector-f0e5f0c6.js";import"./Forward-11ddfa2e.js";const fe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ve=z("path",{d:"M856 376H648V168c0-8.8-7.2-16-16-16H168c-8.8 0-16 7.2-16 16v464c0 8.8 7.2 16 16 16h208v208c0 8.8 7.2 16 16 16h464c8.8 0 16-7.2 16-16V392c0-8.8-7.2-16-16-16zm-480 16v188H220V220h360v156H392c-8.8 0-16 7.2-16 16zm204 52v136H444V444h136zm224 360H444V648h188c8.8 0 16-7.2 16-16V444h156v360z",fill:"currentColor"},null,-1),me=[ve],ce=y({name:"BlockOutlined",render:function(s, d){return n(),O("svg",fe,me)}}),_e=y({__name:"WorkerModeSelect",props:{model:{default:"select"}},setup(p){const s=p,d=H([{label:"Agent",value:"agent"},{label:"SSH",value:"ssh"}]);return(r, f)=>s.model==="select"?(n(),i(t(I),_({key:0,options:d,placeholder:"请选择节点模式"},r.$attrs),null,16,["options"])):s.model==="radio"?(n(),i(t(E),A(_({key:1},r.$attrs)),{default:l(()=>[o(t(D),null,{default:l(()=>[(n(!0),O(P,null,L(d, v=>(n(),i(t(G),{key:v.value,value:v.value},{default:l(()=>[h(T(v.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16)):w("",!0)}}),he=y({__name:"WorkerAuthModeSelect",props:{model:{default:"select"}},setup(p){const s=p,d=H([{label:"用户名密码",value:"password"},{label:"公私钥认证",value:"pub_key"}]);return(r, f)=>s.model==="select"?(n(),i(t(I),_({key:0,options:d,placeholder:"请选择认证模式"},r.$attrs),null,16,["options"])):s.model==="radio"?(n(),i(t(E),A(_({key:1},r.$attrs)),{default:l(()=>[o(t(D),null,{default:l(()=>[(n(!0),O(P,null,L(d, v=>(n(),i(t(G),{key:v.value,value:v.value},{default:l(()=>[h(T(v.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16)):w("",!0)}}),ye=y({__name:"WorkerStatusSelect",setup(p){const s=H([{value:"running",label:"运行中"},{value:"stop",label:"已停止"},{value:"offline",label:"已离线"}]);return(d, r)=>(n(),i(t(I),_({options:s,placeholder:"请选择节点状态"},d.$attrs),null,16,["options"]))}}),ke={style:{display:"block",width:"100%"},flex:"","items-center":""},ge=z("span",{style:{"font-size":"smaller",width:"100%",color:"#f56c6c",display:"inline"}}," 注：1. 作用：用于和任务执行路由来匹配获得执行节点 2. 节点模式为SSH时，路由标识必须为：ssh_ 开头 ",-1),be={flex:"","justify-end":""},K=y({__name:"WorkerModal",props:{record:null},emits:["refresh"],setup(p, {emit:s}){const d=p,{record:r}=j(d),f=q(!1),v=q(null),{run:$,loading:S}=V(W.createWorker),{run:N,loading:x}=V(W.editWorker),e=q({hostname:"",description:"",ip:"",addr:"",port:22,mode:"agent",auth_mode:"password",username:"root",password:"",rsa:"",private:"",version:"",routing_key:"default",weight:100,status:"running"}),c={hostname:{required:!0,message:"请输入主机名",trigger:"blur"},ip:{required:!0,message:"请输入IP",trigger:"blur"},username:{required:!0,message:"请输入IP",trigger:"blur"},password:{required:!0,message:"请输入密码",trigger:"blur"},rsa:{required:!0,message:"请输入私钥内容私钥路径",trigger:"blur"},routing_key:{required:!0,message:"请输入路由标识",trigger:"blur"}},g=q("");Z([g,()=>e.value.mode],()=>{e.value.mode==="ssh"&&(e.value.routing_key="ssh")},{});function J(){f.value=!0,r!=null&&r.value&&(e.value={...r.value})}R(()=>!!(r!=null&&r.value));function Y(){var U;(U=v.value)==null||U.validate(async a=>{if(a)return;e.value.addr=`${e.value.ip}:${e.value.port}`;const{result:u}=r!=null&&r.value?await N(r==null?void 0:r.value.id,e.value):await $(e.value);u&&(f.value=!1,s("refresh"))})}return(U, a)=>(n(),O(P,null,[z("span",{onClick:J},[Q(U.$slots,"default")]),o(t(te),{show:f.value,"onUpdate:show":a[15]||(a[15]= u=>f.value=u),title:"工作节点",preset:"card","auto-focus":!1,"w-200":""},{default:l(()=>[o(t(X),{ref_key:"formRef",ref:v,model:e.value,rules:c},{default:l(()=>[o(t(m),{path:"hostname",label:"主机名",required:""},{default:l(()=>[o(t(k),{value:e.value.hostname,"onUpdate:value":a[0]||(a[0]= u=>e.value.hostname=u),placeholder:"输入主机名",onKeydown:a[1]||(a[1]=ee(ae(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),o(t(m),{path:"description",label:"描述"},{default:l(()=>[o(t(k),{value:e.value.description,"onUpdate:value":a[2]||(a[2]= u=>e.value.description=u),type:"textarea",placeholder:"请输入描述"},null,8,["value"])]),_:1}),o(t(m),{path:"ip",label:"ip",required:""},{default:l(()=>[o(t(k),{value:e.value.ip,"onUpdate:value":a[3]||(a[3]= u=>e.value.ip=u),placeholder:"请输入IP"},null,8,["value"])]),_:1}),o(t(m),{path:"port",label:"端口"},{default:l(()=>[o(t(M),{value:e.value.port,"onUpdate:value":a[4]||(a[4]= u=>e.value.port=u),max:65535,min:1,placeholder:"请输入端口"},null,8,["value"])]),_:1}),o(t(m),{path:"weight",label:"权重"},{default:l(()=>[o(t(M),{value:e.value.weight,"onUpdate:value":a[5]||(a[5]= u=>e.value.weight=u),max:1e3,min:1,placeholder:"请输入权重"},null,8,["value"])]),_:1}),o(t(m),{path:"routing_key",label:"路由标识",required:""},{default:l(()=>[z("div",ke,[o(t(k),{value:e.value.routing_key,"onUpdate:value":a[6]||(a[6]= u=>e.value.routing_key=u),placeholder:"请输入路由标识"},null,8,["value"]),ge])]),_:1}),o(t(m),{path:"mode",label:"节点模式",required:""},{default:l(()=>[o(_e,{value:e.value.mode,"onUpdate:value":a[7]||(a[7]= u=>e.value.mode=u),model:"radio",placeholder:"输入节点模式"},null,8,["value"])]),_:1}),e.value.mode==="ssh"?(n(),i(t(m),{key:0,path:"auth_mode",label:"认证模式",required:""},{default:l(()=>[o(he,{value:e.value.auth_mode,"onUpdate:value":a[8]||(a[8]= u=>e.value.auth_mode=u),model:"radio"},null,8,["value"])]),_:1})):w("",!0),e.value.mode==="ssh"?(n(),i(t(m),{key:1,path:"username",label:"认证用户",required:""},{default:l(()=>[o(t(k),{value:e.value.username,"onUpdate:value":a[9]||(a[9]= u=>e.value.username=u),placeholder:"请输入认证用户"},null,8,["value"])]),_:1})):w("",!0),["password"].indexOf(e.value.auth_mode)>=0&&e.value.mode==="ssh"?(n(),i(t(m),{key:2,path:"password",label:"认证密码",required:""},{default:l(()=>[o(t(k),{value:e.value.password,"onUpdate:value":a[10]||(a[10]= u=>e.value.password=u),type:"password",placeholder:"请输入认证密码"},null,8,["value"])]),_:1})):w("",!0),["pub_key"].indexOf(e.value.auth_mode)>=0&&e.value.mode==="ssh"?(n(),i(t(m),{key:3,path:"rsa",label:"私钥",required:""},{default:l(()=>[o(t(k),{value:e.value.rsa,"onUpdate:value":a[11]||(a[11]= u=>e.value.rsa=u),type:"textarea",placeholder:"请输入私钥内容或路径"},null,8,["value"])]),_:1})):w("",!0),e.value.auth_mode==="pub_key"&&e.value.mode==="ssh"?(n(),i(t(m),{key:4,path:"private",label:"私钥Key"},{default:l(()=>[o(t(k),{value:e.value.private,"onUpdate:value":a[12]||(a[12]= u=>e.value.private=u),placeholder:"请输入私钥Key"},null,8,["value"])]),_:1})):w("",!0),o(t(m),{path:"status",label:"节点状态"},{default:l(()=>[o(ye,{value:e.value.status,"onUpdate:value":a[13]||(a[13]= u=>e.value.status=u),model:"radio",placeholder:"输入节点模式"},null,8,["value"])]),_:1}),z("div",be,[o(t(F),{type:"primary",loading:t(S)||t(x),onClick:a[14]||(a[14]= u=>Y())},{default:l(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),we=y({__name:"WorkerStatus",props:{value:{default:!0}},setup(p){const s=p;return(d, r)=>[!1,"stop"].indexOf(s.value)>=0?(n(),i(B,{key:0,type:"warning",text:"已停止"})):[!0,"running"].indexOf(s.value)>=0?(n(),i(B,{key:1,type:"success",text:"运行中"})):[!0,"offline"].indexOf(s.value)>=0?(n(),i(B,{key:2,type:"error",text:"已离线"})):(n(),i(B,{key:3,type:"warning",text:p.value},null,8,["text"]))}}),xe=y({__name:"OnOffConfirmButton",props:{status:{type:[Boolean,String]},showIco:{type:Boolean},showTxt:{type:Boolean},checkFunction:null,onText:{default:"启用"},offText:{default:"禁用"},onColor:{default:"#409eff"},offColor:{default:"#d03050"}},setup(p){const s=p,{status:d,checkFunction:r}=j(s),f=q(!1),v=R(()=>d.value?`是否${s.offText}`:`是否${s.onText}`),$=R(()=>d.value?`${s.offText}`:`${s.onText}`);async function S(){f.value=!0,await r.value(),f.value=!1}return(N, x)=>(n(),i(t(de),{onPositiveClick:x[0]||(x[0]=()=>S())},{trigger:l(()=>[o(t(F),_({size:"small",loading:f.value,quaternary:""},N.$attrs),{icon:l(()=>[o(t(re),{component:t(ce)},null,8,["component"])]),default:l(()=>[h(" "+T(t($)),1)]),_:1},16,["loading"])]),default:l(()=>[h(" "+T(t(v)),1)]),_:1}))}}),$e=y({__name:"WorkerMode",props:{value:{default:!0}},setup(p){const s=p;return(d, r)=>["agent"].indexOf(s.value)>=0?(n(),i(t(C),_({key:0,type:"primary",text:"Agent"},d.$attrs),{default:l(()=>[h(" Agent ")]),_:1},16)):["ssh"].indexOf(s.value)>=0?(n(),i(t(C),_({key:1,type:"success",text:"SSH"},d.$attrs),{default:l(()=>[h(" SSH ")]),_:1},16)):(n(),i(t(C),_({key:2,type:"warning",text:p.value},d.$attrs),{default:l(()=>[h(T(s.value),1)]),_:1},16,["text"]))}}),Se=y({__name:"WorkerPage",setup(p){const{dataSource:s,loading:d,refresh:r,tableFilter:f,total:v,pagination:$}=ue(W.getWorkerList);async function S(e){const{result:c}=await W.delWorker(e);c&&r()}async function N(e, c){c!=="stop"?c="stop":c="offline";const{result:g}=await W.editWorker(e,{status:c});g&&r()}const x=[{title:"序号",key:"id",width:"65"},{title:"主机名",key:"hostname",resizable:!0,minWidth:"305",render(e){return b(ie,{label:e.description},{default:()=>e.hostname})}},{title:"地址",key:"addr",resizable:!0,width:"185"},{title:"节点模式",key:"mode",resizable:!0,width:"85",render(e){return b($e,{value:e.mode,size:"small"},{default:()=>e.mode})}},{title:"路由标识",key:"routing_key",resizable:!0,width:"115"},{title:"权重",key:"weight",resizable:!0,width:"80"},{title:"状态",key:"status",resizable:!0,width:"95",render(e){return b(we,{value:e.status},{})}},{title:"版本",key:"version",resizable:!0,width:"85"},{title:"更新时间",key:"updated_at",width:"185",resizable:!0},{title:"操作",key:"action",width:"170",fixed:"right",className:"flex item-center task_worker",render(e){return[b(xe,{status:e.status==="running",offColor:"#d8dce1",offText:"禁用",onText:"启用",type:e.status==="running"?"warning":"success",checkFunction:()=>N(e.id,e.status)}),b(K,{record:e,onRefresh:r},{default:()=>b(se)}),b(ne,{confirmText:"是否删除该节点",delFunction:()=>S(e.id)})]}}];return(e, c)=>(n(),i(oe,{"table-filter":t(f),"onUpdate:tableFilter":c[0]||(c[0]= g=>le(f)?f.value=g:null),data:t(s),loading:t(d),columns:x,total:t(v),pagination:t($),"search-key":"name","row-key": g=>g.id,"search-place-holder":"请输入节点名",onRefresh:t(r)},{header:l(()=>[o(K,{onRefresh:t(r)},{default:l(()=>[o(t(F),{type:"primary"},{default:l(()=>[h(" 新增节点 ")]),_:1})]),_:1},8,["onRefresh"])]),_:1},8,["table-filter","data","loading","total","pagination","row-key","onRefresh"]))}});const Ie=pe(Se,[["__scopeId","data-v-7010b788"]]);export{Ie as default};
