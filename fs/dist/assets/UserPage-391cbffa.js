import{d as x,U as F,m as g,i as j,B as y,C as S,I as k,W as T,T as r,E as n,H as a,a2 as D,D as B,a0 as I,X as L,G as C,Y as M,F as O,a8 as W,Z as h,V as A,a9 as H,aa as K,h as m}from"./index-04cf60af.js";import{u as $}from"./useRequest-4a6f3b67.js";import{_ as G}from"./RoleSelect.vue_vue_type_script_setup_true_lang-5ae5ad7f.js";import{N as X}from"./Switch-bf288972.js";import{N as V,a as p}from"./FormItem-960404fe.js";import{N as c}from"./Input-d7ad98e8.js";import{u as Y,_ as Z}from"./useTableData-de23e2bc.js";import{_ as J,a as Q}from"./EditButton.vue_vue_type_script_setup_true_lang-3dcaf37c.js";import{_ as ee}from"./TooltipText.vue_vue_type_script_setup_true_lang-dced7f62.js";import{v as ae,_ as te,a as le}from"./AutoOmissionTag.vue_vue_type_script_setup_true_lang-bfc37ea6.js";import{N as se}from"./Icon-b6ee2b01.js";import{b as re}from"./Dropdown-ff39b5a5.js";import"./get-a19d687e.js";import"./Forward-9eb42cee.js";import"./FocusDetector-40d296f1.js";import"./Space-d4aba141.js";const oe={flex:"","justify-end":""},z=x({__name:"UserModal",props:{record:null},emits:["refresh"],setup(_,{emit:v}){const w=_,{record:s}=F(w),i=g(!1),d=g(null),{run:b,loading:P}=$(h.createUser),{run:U,loading:N}=$(h.editUser),t=g({username:"",nickname:"",email:"",phone:"",role_ids:[],user_type:"local",status:!0,password:null}),o={name:{required:!0,message:"请输入部门名",trigger:"blur"},password:{required:!0,message:"请输入密码",trigger:"blur"}};function f(){var u,e;if(i.value=!0,s!=null&&s.value){const l=(e=(u=s.value)==null?void 0:u.roles)==null?void 0:e.map(E=>E.id);t.value={...s.value,role_ids:l}}}const R=j(()=>!!(s!=null&&s.value));function q(){var u;(u=d.value)==null||u.validate(async e=>{if(e)return;const{result:l}=s!=null&&s.value?await U(s==null?void 0:s.value.id,t.value):await b(t.value);l&&(i.value=!1,v("refresh"))})}return(u,e)=>(y(),S(O,null,[k("span",{onClick:f},[T(u.$slots,"default")]),r(a(M),{show:i.value,"onUpdate:show":e[9]||(e[9]=l=>i.value=l),title:"部门",preset:"card","auto-focus":!1,"w-200":""},{default:n(()=>[r(a(V),{ref_key:"formRef",ref:d,model:t.value,rules:o},{default:n(()=>[r(a(p),{path:"nickname",label:"显示名"},{default:n(()=>[r(a(c),{value:t.value.nickname,"onUpdate:value":e[0]||(e[0]=l=>t.value.nickname=l),placeholder:"输入显示名",onKeydown:e[1]||(e[1]=D(W(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),r(a(p),{path:"username",label:"用户名"},{default:n(()=>[r(a(c),{value:t.value.username,"onUpdate:value":e[2]||(e[2]=l=>t.value.username=l),disabled:a(R),placeholder:"请输入用户名"},null,8,["value","disabled"])]),_:1}),a(R)?I("",!0):(y(),B(a(p),{key:0,path:"password",label:"密码",required:""},{default:n(()=>[r(a(c),{value:t.value.password,"onUpdate:value":e[3]||(e[3]=l=>t.value.password=l),placeholder:"请输入用户名"},null,8,["value"])]),_:1})),r(a(p),{path:"email",label:"邮箱"},{default:n(()=>[r(a(c),{value:t.value.email,"onUpdate:value":e[4]||(e[4]=l=>t.value.email=l),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),r(a(p),{path:"phone",label:"电话"},{default:n(()=>[r(a(c),{value:t.value.phone,"onUpdate:value":e[5]||(e[5]=l=>t.value.phone=l),placeholder:"请输入电话"},null,8,["value"])]),_:1}),r(a(p),{path:"role_ids",label:"用户角色"},{default:n(()=>[r(G,{value:t.value.role_ids,"onUpdate:value":e[6]||(e[6]=l=>t.value.role_ids=l),multiple:"",placeholder:"输入用户角色"},null,8,["value"])]),_:1}),r(a(p),{path:"status",label:"状态"},{default:n(()=>[r(a(X),{value:t.value.status,"onUpdate:value":e[7]||(e[7]=l=>t.value.status=l),placeholder:"请输入"},null,8,["value"])]),_:1}),k("div",oe,[r(a(L),{type:"primary",loading:a(P)||a(N),onClick:e[8]||(e[8]=l=>q())},{default:n(()=>[C(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},ue=k("path",{d:"M21 2a8.998 8.998 0 0 0-8.612 11.612L2 24v6h6l10.388-10.388A9 9 0 1 0 21 2zm0 16a7.013 7.013 0 0 1-2.032-.302l-1.147-.348l-.847.847l-3.181 3.181L12.414 20L11 21.414l1.379 1.379l-1.586 1.586L9.414 23L8 24.414l1.379 1.379L7.172 28H4v-3.172l9.802-9.802l.848-.847l-.348-1.147A7 7 0 1 1 21 18z",fill:"currentColor"},null,-1),ie=k("circle",{cx:"22",cy:"10",r:"2",fill:"currentColor"},null,-1),de=[ue,ie],pe=x({name:"Password",render:function(v,w){return y(),S("svg",ne,de)}}),fe=x({__name:"ResetPasswordButton",props:{btnText:{default:"重置密码"}},setup(_){const v=_,{btnText:w}=F(v),s=g(!1);return(i,d)=>(y(),B(a(L),H({size:"small",loading:s.value,type:"warning",quaternary:""},i.$attrs),{icon:n(()=>[r(a(se),{component:a(pe)},null,8,["component"])]),default:n(()=>[C(" "+A(a(w)),1)]),_:1},16,["loading"]))}}),me={flex:"","justify-end":""},ve=x({__name:"RestPassword",props:{id:null,showOldPassword:{type:Boolean,default:!0}},emits:["refresh"],setup(_,{emit:v}){const w=_,{id:s,showOldPassword:i}=F(w),d=g(!1),b=g(null),{run:P,loading:U}=$(h.passRestById),{run:N,loading:t}=$(h.resetOneselfPassword),o=g({oldPassword:"",newPassword:"",validateNewPassword:""}),f={oldPassword:{required:!0,message:"请输入旧密码",trigger:"blur"},newPassword:{required:!0,validator(u,e){if(e){if(e===o.value.oldPassword)return new Error("不能与旧密码一样")}else return new Error("请输入新密码");return!0},trigger:"blur"},validateNewPassword:{required:!0,validator(u,e){if(e){if(e!==o.value.newPassword)return new Error("与新密码不一致")}else return new Error("请输入新密码");return!0},trigger:"blur"},email:{required:!1,validator(u,e){if(e){if(!ae(e))return new Error("请输入正确的邮箱地址")}else return!0;return!0},trigger:"blur"}},R=()=>{d.value=!0},q=async()=>{var u;(u=b.value)==null||u.validate(async e=>{if(e)return;const l={old_password:o.value.oldPassword,password:o.value.newPassword},{result:E}=s!=null&&s.value?await P({...l,id:s.value}):await N(l);E&&(d.value=!1,v("refresh"))})};return(u,e)=>(y(),S(O,null,[k("span",{onClick:R},[T(u.$slots,"default")]),r(a(M),{show:d.value,"onUpdate:show":e[4]||(e[4]=l=>d.value=l),title:"重置密码",preset:"card","auto-focus":!1,"w-100":""},{default:n(()=>[r(a(V),{ref_key:"formRef",ref:b,model:o.value,rules:f},{default:n(()=>[a(i)?(y(),B(a(p),{key:0,path:"oldPassword",label:"旧密码"},{default:n(()=>[r(a(c),{value:o.value.oldPassword,"onUpdate:value":e[0]||(e[0]=l=>o.value.oldPassword=l),type:"password","show-password-on":"click",placeholder:"输入旧密码"},null,8,["value"])]),_:1})):I("",!0),r(a(p),{path:"newPassword",label:"新密码"},{default:n(()=>[r(a(c),{value:o.value.newPassword,"onUpdate:value":e[1]||(e[1]=l=>o.value.newPassword=l),placeholder:"输入新密码",type:"password","show-password-on":"click"},null,8,["value"])]),_:1}),r(a(p),{path:"validateNewPassword",label:"二次确认密码"},{default:n(()=>[r(a(c),{value:o.value.validateNewPassword,"onUpdate:value":e[2]||(e[2]=l=>o.value.validateNewPassword=l),placeholder:"输入二次确认密码",type:"password","show-password-on":"click"},null,8,["value"])]),_:1}),k("div",me,[r(a(L),{type:"primary",loading:a(U)||a(t),onClick:e[3]||(e[3]=l=>q())},{default:n(()=>[C(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),Ce=x({__name:"UserPage",setup(_){const{dataSource:v,loading:w,refresh:s,tableFilter:i,total:d,pagination:b}=Y(h.getUserList);async function P(t){const{result:o}=await h.delUser(t);o&&s()}async function U(t,o){const{result:f}=await h.editUser(t,{status:o});f&&s()}const N=[{title:"序号",key:"id",width:"65"},{title:"用户",key:"nickname",width:"135",resizable:!0,render(t){return m(ee,{label:""},{default:()=>t.nickname})}},{title:"用户名",key:"username",minWidth:"135",resizable:!0},{title:"邮箱",key:"email",resizable:!0},{title:"类型",key:"user_type",align:"center",width:"80",render(t){return m(re,{bordered:!1,type:"primary"},{default:()=>t.user_type})}},{title:"角色",key:"roles",minWidth:"190",resizable:!0,ellipsis:{tooltip:{maxWidth:500}},render(t){var o;return m(te,{names:(o=t.roles)==null?void 0:o.map(f=>f.name)},{})}},{title:"状态",key:"status",width:90,fixed:"right",render(t){return m(le,{status:t.status,checkFunction:()=>U(t.id,!t.status)})}},{title:"操作",key:"action",width:"270",fixed:"right",render(t){return[m(z,{record:t,onRefresh:s},{default:()=>m(J)}),t.user_type==="local"&&m(ve,{id:t.id,onRefresh:s,showOldPassword:!1},{default:()=>m(fe)}),m(Q,{confirmText:"是否删除该用户",delFunction:()=>P(t.id)})]}}];return(t,o)=>(y(),B(Z,{"table-filter":a(i),"onUpdate:tableFilter":o[0]||(o[0]=f=>K(i)?i.value=f:null),data:a(v),loading:a(w),columns:N,total:a(d),pagination:a(b),"search-key":"name","search-place-holder":"请输入用户名",onRefresh:a(s)},{header:n(()=>[r(z,{onRefresh:a(s)},{default:n(()=>[r(a(L),{type:"primary"},{default:n(()=>[C(" 新增用户 ")]),_:1})]),_:1},8,["onRefresh"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"]))}});export{Ce as default};
