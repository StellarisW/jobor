(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a8ad772"],{"0c1f":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[a("el-select",{attrs:{value:e.selectValue,filterable:"",placeholder:"请选择",clearable:e.clearable,multiple:!e.single_selection,"collapse-tags":e.collapse_tags,"allow-create":e.allowCreate},on:{change:e.handleChange}},e._l(e.data_list,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)},o=[],r={name:"role_select",props:{single_selection:{default:!0},clearable:{default:!0},collapse_tags:{default:!0},allowCreate:{default:!1},selectValue:{required:!1}},data:function(){return{url:this.$store.state.urls.role_url,data_list:[],total:0}},watch:{},methods:{getData:function(){var e=this,t={};this.loading=!0,this.$store.dispatch("common/Query",{url:this.url+"s",data:t}).then((function(t){e.data_list=t.data.data.list,e.total=t.data.data.total})).catch((function(e){}))},handleChange:function(e){this.$emit("update:selectValue",e)}},mounted:function(){this.getData()}},l=r,i=a("2877"),n=Object(i["a"])(l,s,o,!1,null,"70de8b48",null);t["a"]=n.exports},e7ed:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("div",{staticStyle:{margin:"5px 0"}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.SearchForm,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{placeholder:"显示名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData(t)}},model:{value:e.SearchForm.nickname,callback:function(t){e.$set(e.SearchForm,"nickname",t)},expression:"SearchForm.nickname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{placeholder:"用户名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData(t)}},model:{value:e.SearchForm.username,callback:function(t){e.$set(e.SearchForm,"username",t)},expression:"SearchForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("role_select",{attrs:{selectValue:e.SearchForm.roles,single_selection:!1},on:{"update:selectValue":function(t){return e.$set(e.SearchForm,"roles",t)},"update:select-value":function(t){return e.$set(e.SearchForm,"roles",t)}}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.NewRow}},[e._v("新增")]),e._v(" "),a("el-button",{staticStyle:{float:"right"},on:{click:function(t){return e.getData()}}},[e._v("刷新")])],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.tableData,size:"mini"}},[a("el-table-column",{attrs:{label:"ID",prop:"id",width:"60",align:""}}),e._v(" "),a("el-table-column",{attrs:{label:"显示名/用户名",prop:"nickname",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{"font-size":"12px"}},[e._v(e._s(t.row.nickname))]),e._v(" "),a("el-link",{staticStyle:{display:"block","font-size":"12px"},attrs:{underline:!1,type:"primary"}},[e._v(e._s(t.row.username))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"用户类型",prop:"user_type_id",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["local"===t.row.user_type?a("el-tag",{attrs:{size:"mini",type:"primary",plain:!0}},[e._v("本地")]):"ldap"===t.row.user_type?a("el-tag",{attrs:{size:"mini",type:"primary",plain:!0}},[e._v("LDAP")]):a("el-tag",{attrs:{size:"mini",type:"primary",plain:!0}},[e._v("其它")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"邮箱",prop:"email"}}),e._v(" "),a("el-table-column",{attrs:{label:"角色",prop:"roles"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.roles,(function(s,o){return t.row.hidden&&o<3||!t.row.hidden?a("el-tag",{key:o,staticStyle:{margin:"1px 2px"},attrs:{size:"mini",plain:!0,type:"primary"}},[e._v(e._s(s.name))]):e._e()})),e._v(" "),t.row.roles.length>3&&t.row.hidden?a("el-tag",{staticStyle:{margin:"0 2px",cursor:"pointer"},attrs:{size:"mini"},on:{click:function(e){t.row.hidden=!1}}},[e._v("…+"+e._s(t.row.roles.length-3))]):e._e(),e._v(" "),t.row.roles.length>3&&!t.row.hidden?a("el-tag",{staticStyle:{margin:"0 2px",cursor:"pointer"},attrs:{size:"mini",type:"info"},on:{click:function(e){t.row.hidden=!0}}},[e._v("隐藏")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"by_update",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.ChangeStatus(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"更新人",prop:"by_update",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"#e6a23c"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.showEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.ConfirmDelRows(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"5px"}},[a("div",{staticStyle:{display:"inline"}}),e._v(" "),a("div",{staticClass:"block",staticStyle:{float:"right",display:"inline"}},[a("pagination",{attrs:{total:e.total,page:e.page,limit:e.limit},on:{"update:page":function(t){e.page=t},"update:limit":function(t){e.limit=t},pagination:function(t){return e.getData()}}})],1)])],1),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.NewOrUpdate},on:{"update:visible":function(t){e.NewOrUpdate=t}}},[a("el-form",{ref:"RowData",attrs:{"label-width":"80px",model:e.RowData,size:"small"}},[a("el-form-item",{attrs:{label:"显示名",prop:"nickname",rules:[{required:!0,message:"请输入显示名",trigger:"blur"}]}},[a("el-input",{model:{value:e.RowData.nickname,callback:function(t){e.$set(e.RowData,"nickname",t)},expression:"RowData.nickname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名",prop:"username",rules:[{required:!0,message:"请输入用户名，如：zhansan",trigger:"blur"}]}},[a("el-input",{model:{value:e.RowData.username,callback:function(t){e.$set(e.RowData,"username",t)},expression:"RowData.username"}})],1),e._v(" "),"local"===e.RowData.user_type&&e.RowData.id?a("el-form-item",{attrs:{label:"密码"}},[a("el-button",{on:{click:function(t){e.setPassword.id=e.RowData.id,e.dialogPassword=!0}}},[e._v("修改密码")])],1):e._e(),e._v(" "),e.RowData.id?e._e():a("el-form-item",{attrs:{label:"密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]}},[a("el-input",{attrs:{type:e.passwordType},model:{value:e.RowData.password,callback:function(t){e.$set(e.RowData,"password",t)},expression:"RowData.password"}},[a("span",{staticClass:"show-pwd",staticStyle:{cursor:"pointer"},attrs:{slot:"append"},on:{click:e.showPwd},slot:"append"},[a("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)])],1),e._v(" "),e.RowData.id?e._e():a("el-form-item",{attrs:{label:"确认密码",prop:"repassword",rules:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:e.validateCheckPass,trigger:"blur"}]}},[a("el-input",{attrs:{type:"password"},model:{value:e.RowData.repassword,callback:function(t){e.$set(e.RowData,"repassword",t)},expression:"RowData.repassword"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱",prop:"email",rules:[{required:!0,message:"请输入Email",trigger:"blur"},{pattern:/^[a-z0-9]+([._\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/,message:"请输入有效的邮箱",trigger:"blur"}]}},[a("el-input",{model:{value:e.RowData.email,callback:function(t){e.$set(e.RowData,"email",t)},expression:"RowData.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号",prop:"phone",rules:[{pattern:/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,message:"手机格式不对",trigger:"blur"}]}},[a("el-input",{model:{value:e.RowData.phone,callback:function(t){e.$set(e.RowData,"phone",t)},expression:"RowData.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户类型",prop:"user_type",rules:[{required:!0,message:"请输入选择用户类型",trigger:"blur"}]}},[a("el-select",{attrs:{value:"",disabled:""},model:{value:e.RowData.user_type,callback:function(t){e.$set(e.RowData,"user_type",t)},expression:"RowData.user_type"}},[a("el-option",{attrs:{value:"local",label:"本地"}}),e._v(" "),a("el-option",{attrs:{value:"ldap",label:"LDAP"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"选择角色"}},[a("role_select",{attrs:{selectValue:e.RowData.roles,single_selection:!1},on:{"update:selectValue":function(t){return e.$set(e.RowData,"roles",t)},"update:select-value":function(t){return e.$set(e.RowData,"roles",t)}}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.NewOrUpdate=!1}}},[e._v("取 消")]),e._v(" "),e.RowData.id?a("el-button",{attrs:{plain:!0,type:"warning",loading:e.action_loading},on:{click:function(t){return e.createOrUpdate("PUT",!1)}}},[e._v("更新")]):e._e(),e._v(" "),e.RowData.id?e._e():a("el-button",{attrs:{plain:!0,type:"warning",loading:e.action_loading},on:{click:function(t){return e.createOrUpdate("POST",!0)}}},[e._v("保存并继续")]),e._v(" "),e.RowData.id?e._e():a("el-button",{attrs:{plain:!0,type:"primary",loading:e.action_loading},on:{click:function(t){return e.createOrUpdate("POST",!1)}}},[e._v("保 存")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改密码",visible:e.dialogPassword,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogPassword=t}}},[a("el-form",{ref:"setPassword",attrs:{size:"mini","label-width":"120px",model:e.setPassword}},[a("el-form-item",{attrs:{hidden:""}},[a("el-input",{model:{value:e.setPassword.id,callback:function(t){e.$set(e.setPassword,"id",t)},expression:"setPassword.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"新密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]}},[a("el-input",{staticStyle:{width:"240px"},attrs:{autocomplete:"off",type:"password"},model:{value:e.setPassword.password,callback:function(t){e.$set(e.setPassword,"password",t)},expression:"setPassword.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认新密码",prop:"aginpassword",rules:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:e.CheckPass,trigger:"blur"}]}},[a("el-input",{staticStyle:{width:"240px"},attrs:{autocomplete:"off",type:"password"},model:{value:e.setPassword.aginpassword,callback:function(t){e.$set(e.setPassword,"aginpassword",t)},expression:"setPassword.aginpassword"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogPassword=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.password_loading,expression:"password_loading"}],attrs:{plain:!0,type:"primary"},on:{click:e.changePassword}},[e._v("确 定")])],1)],1)],1)},o=[],r=a("0c1f"),l=a("26e4"),i={name:"user",data:function(){return{passwordType:"password",dialogPassword:!1,setPassword:{},SearchForm:{nickname:"",username:"",roles:[]},RowData:{nickname:"",username:"",email:"",phone:"",password:"",repassword:"",user_type:"local",roles:[],id:""},NewOrUpdate:!1,action_loading:!1,again_loading:!1,password_loading:!1,title:"新增",roles:[],tableData:[],total:0,page:1,limit:10,loading:!1,url:this.$store.state.urls.user_url,password_url:this.$store.state.urls.password_url}},methods:{validateCheckPass:function(e,t,a){""===t?a(new Error("请再次输入密码")):t!==this.RowData.password?a(new Error("两次输入密码不一致!")):a()},CheckPass:function(e,t,a){""===t?a(new Error("请再次输入密码")):t!==this.setPassword.password?a(new Error("两次输入密码不一致!")):a()},showPwd:function(){"password"===this.passwordType?this.passwordType="":this.passwordType="password"},changePassword:function(){var e=this;this.$refs.setPassword.validate((function(t){if(t){var a=e.setPassword;e.password_loading=!0;var s=e.url+"-pass-reset/"+e.setPassword.id;e.$store.dispatch("user/setPassword",{url:s,data:a}).then((function(t){e.dialogPassword=!1,e.$message.success(t.data.message),e.password_loading=!1})).catch((function(t){e.password_loading=!1}))}else e.$message.warning("请输入完整数据")}))},getData:function(){var e=this,t={pageSize:this.limit,pageNumber:this.page,nickname:this.SearchForm.nickname,username:this.SearchForm.username,roles:this.SearchForm.roles};this.loading=!0,this.$store.dispatch("common/Query",{url:this.url,data:t}).then((function(t){for(var a=0;a<t.data.data.list.length;++a)t.data.data.list[a].hidden=!0;e.tableData=t.data.data.list,e.total=t.data.data.total,e.loading=!1})).catch((function(t){e.loading=!1}))},createOrUpdate:function(e,t){var a=this;this.$refs.RowData.validate((function(s){if(s){var o=JSON.parse(JSON.stringify(a.RowData)),r=a.url;"PUT"===e&&(r=r+"/"+o.id),"POST"===e&&delete o.id,a.action_loading=!0,a.$store.dispatch("common/CreateUpdate",{url:r,method:e,data:o}).then((function(e){200===e.data.code?(a.$message.success(e.data.message),!1===t&&(a.NewOrUpdate=!1),a.getData()):a.$message.error(e.data.message),a.action_loading=!1})).catch((function(e){a.action_loading=!1}))}else a.$message.warning("请输入完整数据")}))},ChangeStatus:function(e){var t=this,a={id:e.id,status:e.status},s=this.url+"/"+a.id;this.$store.dispatch("common/CreateUpdate",{url:s,method:"PUT",data:a}).then((function(e){t.$message.success(e.data.message),t.getData()})).catch((function(e){}))},showEdit:function(e){this.NewOrUpdate=!0,this.title="编辑",this.RowData.id=e.id,this.RowData.nickname=e.nickname,this.RowData.username=e.username,this.RowData.user_type=e.user_type,this.RowData.email=e.email,this.RowData.phone=e.phone;for(var t=[],a=0;e.roles.length>a;a++)t.push(e.roles[a].id);this.RowData.roles=t},NewRow:function(){this.NewOrUpdate=!0,this.title="添加",this.RowData.id="",this.RowData.nickname="",this.RowData.username="",this.RowData.user_type="local",this.RowData.email="",this.RowData.phone="",this.RowData.password="",this.RowData.repassword="",this.RowData.roles=[]},ConfirmDelRows:function(e){var t=this;this.$confirm("确认删除用户："+e.nickname+"<"+e.username+">","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.action_loading=!0,t.$store.dispatch("common/Delete",{url:t.url,data:{rows:[e.id]}}).then((function(e){200===e.data.code?(t.$message.success(e.data.message),t.getData()):t.$message.error(e.data.message),t.action_loading=!1})).catch((function(e){t.action_loading=!1}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}},mounted:function(){this.getData()},components:{pagination:l["a"],role_select:r["a"]}},n=i,c=a("2877"),d=Object(c["a"])(n,s,o,!1,null,"e8a115de",null);t["default"]=d.exports}}]);